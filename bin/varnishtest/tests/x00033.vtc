varnishtest "Test Key matcher functionality"

server s1 {
	rxreq
	txresp -hdr "Key: Foobar;w=\"foo\";p=\"test\";b=\"win\";c;s=\"iNnInG\";n;w=\"bar\""
	rxreq
	txresp -hdr "Key: Foobar;w=\"foo\";p=\"test\";b=\"win\";c;s=\"iNnInG\";n;w=\"bar\""
} -start

varnish v1 -vcl+backend {} -start

client c1 {
	txreq -hdr "Foobar: foo,test;bar,wiNnInG"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1001"

	txreq -hdr "Foobar: foo,test;bar,wiNnInG"
	rxresp
	expect resp.status == 200
	expect resp.http.X-Varnish == "1002 1001"
} -run
